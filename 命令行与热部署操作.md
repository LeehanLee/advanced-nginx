**（未完成）**


联系作者
- weixin: 363260961
- QQ: 363260961

**编写不易，转载请注明出处https://github.com/Zhucola/advanced-nginx**

使用版本
- CentOS Linux release 7.5.1804 (Core)
- nginx/1.12.2版本
- curl 7.61.0 (x86_64-pc-linux-gnu) libcurl/7.61.0 OpenSSL/1.0.2k zlib/1.2.7

默认编译后，nginx的可执行二进制文件在/usr/local/nginx/sbin目录下，可执行文件为nginx

我们需要执行
```
  cp /usr/local/nginx/sbin/nginx /usr/bin
```

这样才可以在全局中直接找到nginx的二进制文件

**启动**

直接执行nginx

如果服务器已经有nginx在执行，再次执行nginx会报错
```
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
```

**重新开始记录日志**
```
  nginx -s reopen
```
其实这个命令就是
```
  kill -USR1 nginx.pid  # nginx.pid为nginx的master进程ID
```

有时需求为将nginx的access和error日志按小时切割

如果access和error日志位置在/tmp目录下

```
  1. mv /tmp/nginx_access.log  mv /tmp/nginx_access.log.2018.11.07.11
  2. mv /tmp/nginx_error.log  mv /tmp/nginx_error.log.2018.11.07.11
  3.nginx -s reopen
```
执行后，将会在/tmp目录下面再次创建/tmp/nginx_access.log和/tmp/nginx_error.log日志文件

**检测语法错误**
```
  nginx -t
  nginx -T
```
这两个命令都可以检测配置文件是否有语法错误

一般为先检测语法错误，然后在启动或者重启nginx

**查看版本信息和编译配置**
```
  nginx -v
  nginx -V
```
-v可以显示nginx的版本信息

-V不光可以显示版本信息，还可以显示编译时候的配置、使用的编译gcc版本、OpenSSL信息
```
[root@localhost conf]# nginx -V
nginx version: nginx/1.12.2
built by gcc 4.8.5 20150623 (Red Hat 4.8.5-28) (GCC) 
built with OpenSSL 1.0.2k-fips  26 Jan 2017
TLS SNI support enabled
configure arguments: --with-http_ssl_module --with-select_module --with-debug
```

**热部署**
如果需要升级nginx或者更改编译配置，不需要kill掉nginx的master进程，这样会断开正在连接中的tcp请求，造成短时间内服务器不可用

热部署就是在nginx运行期间升级nginx或者更改编译配置

如果正在运行的nginx编译在/usr/local/nginx目录下

1.首先编译一个新的nginx，将configure的--prefix配置指向新的目录
```
  ./configure --prefix=/usr/local/new_nginx  && make && make install
```
2.对正在运行的可执行二进制文件进行修改
```
  rm -rf /usr/local/nginx/sbin/nginx.old
  mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.old  # 需要保留旧的二进制文件用来回滚
  cp /usr/local/new_nginx/sbin/nginx /usr/local/nginx/sbin/nginx
```
3. 给正在运行的nginx热部署指令
```
   kill -USR2 nginx.old.pid  # nginx.old.pid是正在运行的nginx的master进程号
```
